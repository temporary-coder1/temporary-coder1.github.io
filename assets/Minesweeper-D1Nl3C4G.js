import{_ as ce,u as he,r as f,i as me,j as R,o as fe,k as ve,c as w,b as l,l as L,f as C,m as pe,F as ge,p as Me,q as B,e as N,d as U,v as V,s as A,T as q,t as H,x as we,y as Z,z as ye,n as be,h as y}from"./index-DcJe6jmK.js";const Se={class:"game-settings"},xe={class:"settings-grid"},ke={class:"setting-item"},Ce=["value"],Te={key:0,class:"custom-settings"},_e=["max"],Re={class:"actions",style:{display:"flex",gap:"8px"}},Ne=["disabled"],Ve={class:"seed-input"},Ae={style:{display:"flex",gap:"8px"}},ze={class:"copy-seed"},De={key:0,class:"copied-popup"},Ee={class:"stats"},Fe={class:"progress"},Ie={class:"bar"},Pe={class:"canvas-wrapper"},We={key:0,class:"overlay win"},Le={key:0,class:"overlay lose"},Be=12,z=4,D=61,b="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",Ue={__name:"Minesweeper",setup(qe){const S=he(),$=[{id:"very easy",label:"VÃ¤ldigt LÃ¤tt",cfg:[9,9,1]},{id:"easy",label:"LÃ¤tt",cfg:[9,9,10]},{id:"medium",label:"Medel",cfg:[16,16,40]},{id:"hard",label:"SvÃ¥r",cfg:[30,16,99]},{id:"extreme",label:"Extrem",cfg:[40,30,200]}];function x(s){return getComputedStyle(document.documentElement).getPropertyValue(s).trim()}const G=s=>{let e="";do e=b[s%62]+e,s=Math.floor(s/62);while(s);return e},O=s=>[...s].reduce((e,t)=>e*62+b.indexOf(t),0);class J{constructor(e,t){this.x=e,this.y=t,this.isMine=!1,this.isMarked=!1,this.isShown=!1,this.neighbors=[]}}class Q{constructor(){this.rows=9,this.columns=9,this.mines=10,this.blockSize=24,this.grid=[],this.seed=Math.floor(Math.random()*238e3),this.placedMines=0,this.showedNodes=0,this.nodesToReveal=[],this.gameStatus=-1,this.showMines=!1,this.time=0,this.revealVersion=0}initGrid(){this.grid=[];for(let t=0;t<this.rows;t++){this.grid.push([]);for(let n=0;n<this.columns;n++)this.grid[t].push(new J(n,t))}const e=[[0,1],[1,0],[0,-1],[-1,0],[1,1],[1,-1],[-1,-1],[-1,1]];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++){const a=[];for(const[u,o]of e){const c=n+u,k=t+o;c>=0&&c<this.columns&&k>=0&&k<this.rows&&a.push(this.grid[k][c])}this.grid[t][n].neighbors=a}}prng(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}plantMines(e=null){let t=this.grid.flat().filter(n=>n!==e&&!n.isShown);for(this.placedMines=0;this.placedMines<this.mines;){const n=Math.floor(this.prng(this.seed+this.placedMines)*t.length),a=t[n];a.isMine=!0,t.splice(n,1),this.placedMines++}}revealNode(e){if(e.isShown||e.isMine)return;if(e.isShown=!0,this.showedNodes++,e.neighbors.filter(n=>n.isMine).length===0)for(const n of e.neighbors)this.nodesToReveal.includes(n)||n.isShown||n.isMine||this.nodesToReveal.push(n)}async revealRecursive(e=null){const t=this.revealVersion;e&&this.nodesToReveal.push(e);let n=0;for(;this.nodesToReveal.length;){if(this.revealVersion!==t){this.nodesToReveal=[];return}const a=this.nodesToReveal.shift();n%5===0&&(await se(20),await be(),W()),this.revealNode(a),n++}}async revealFirstClick(e,t=Be){const n=this.grid.flat().filter(a=>!a.isMine&&!a.isShown);n.sort((a,u)=>{const o=Math.abs(a.x-e.x)+Math.abs(a.y-e.y),c=Math.abs(u.x-e.x)+Math.abs(u.y-e.y);return o-c}),this.nodesToReveal.push(...n.slice(0,t)),await this.revealRecursive()}async act(e,t){if(!(this.gameStatus===2||this.gameStatus===1))if(t===0){if(this.gameStatus===-1){this.gameStatus=0,e.isMine&&(e.isMine=!1,this.plantMines(e)),await this.revealFirstClick(e),this.checkWin();return}e.isMarked||(e.isMine?this.explode(e):(await this.revealRecursive(e),this.checkWin()))}else t===2&&(e.isShown||(e.isMarked=!e.isMarked))}explode(e){this.gameStatus=2,this.showMines=!0;const t=this.grid.flat().filter(n=>n.isMine);t.sort(()=>Math.random()-.5),t.forEach((n,a)=>{setTimeout(()=>{n.isShown=!0},a*50)})}checkWin(){const e=this.rows*this.columns;e-this.showedNodes===this.mines&&(this.gameStatus=1,this.showMines=!0,console.log("You win!"),ie()),console.log(`Cleared: ${this.showedNodes}/${e-this.mines}`)}}const d=f(null),r=f(null),T=Math.ceil(window.devicePixelRatio||1),v=f("easy"),p=f(""),E=f(!1),i=me(new Q);let F=null,j=performance.now();const h=f(9),m=f(9),g=f(10),ee=R(()=>i.mines-i.grid.flat().filter(s=>s.isMarked).length),K=R(()=>100*i.showedNodes/(i.rows*i.columns-i.mines)),te=R(()=>i.time),I=R(()=>i.gameStatus);async function se(s){return new Promise(e=>setTimeout(e,s))}function ie(){const s=d.value.width,e=d.value.height,t=d.value.getContext("2d"),n=Array.from({length:200},()=>({x:Math.random()*s,y:Math.random()*-e,r:4+Math.random()*4,d:8+Math.random()*8,color:`hsl(${Math.random()*360},90%,60%)`,tilt:Math.random()*10-10,tiltAngle:0,tiltAngleIncremental:Math.random()*.07+.05}));let a=0;function u(){a+=.01;for(const o of n)o.y+=(Math.cos(a+o.d)+3+o.r/2)/2,o.x+=Math.sin(a+Math.random()*.2),o.tiltAngle+=o.tiltAngleIncremental,o.tilt=Math.sin(o.tiltAngle)*15,t.beginPath(),t.lineWidth=o.r,t.strokeStyle=o.color,t.moveTo(o.x+o.tilt+o.r,o.y),t.lineTo(o.x+o.tilt,o.y+o.tilt+o.r),t.stroke();n.some(o=>o.y<e)&&i.gameStatus===1&&(requestAnimationFrame(W),requestAnimationFrame(u))}u()}function P(){if(v.value==="custom")i.columns=h.value,i.rows=m.value,i.mines=g.value;else{const s=$.find(e=>e.id===v.value).cfg;[i.columns,i.rows,i.mines]=s,h.value=i.columns,m.value=i.rows,g.value=i.mines}}function M(){i.revealVersion++,i.time=0,p.value=X(h.value,m.value,g.value),i.gameStatus=-1,i.showMines=!1,i.nodesToReveal=[],i.showedNodes=0,i.placedMines=0,P(),i.initGrid(),i.plantMines(),_()}function X(s,e,t){const n=b[s]+b[e]+G(t).padStart(2,"0"),a=G(i.seed).padStart(3,"0");return n+a}function ne(s){if(s.length<5)throw new Error("Bad seed");let e={w:b.indexOf(s[0]),h:b.indexOf(s[1]),m:O(s.slice(2,4)),r:s.slice(4)};return console.log(s),console.log(e),e}function le(){i.seed=Math.floor(Math.random()*238e3),p.value=i.seed,M()}function ae(){i.revealVersion++;const{w:s,h:e,m:t,r:n}=ne(p.value);i.columns=s,i.rows=e,i.mines=Math.min(t,s*e-1),i.seed=O(n)||Math.floor(Math.random()*238e3),p.value=X(s,e,t),i.time=0,i.gameStatus=-1,i.showMines=!1,i.showedNodes=0,i.placedMines=0,i.initGrid(),i.plantMines(),_()}function oe(){const s=Math.max(z,Math.min(D,h.value)),e=Math.max(z,Math.min(D,m.value)),t=Math.max(1,Math.min(s*e-1,g.value));h.value=s,m.value=e,g.value=t,v.value="custom",M()}function re(){navigator.clipboard.writeText(p.value),E.value=!0,setTimeout(()=>{E.value=!1},1200)}function _(){if(!d.value)return;const s=window.innerWidth*.8,e=window.innerHeight*.6,t=s/i.columns,n=e/i.rows;i.blockSize=Math.floor(Math.min(t,n));const a=i.blockSize*i.columns,u=i.blockSize*i.rows;d.value.style.width=`${a}px`,d.value.style.height=`${u}px`,d.value.width=a*T,d.value.height=u*T}function W(){if(!r.value)return;const{blockSize:s}=i;r.value.save(),r.value.scale(T,T),r.value.fillStyle=x("--theme-canvas-grid")||(S.isDarkMode?"#2e2e2e":"#d5d5d5"),r.value.fillRect(0,0,d.value.width,d.value.height),r.value.font=`${Math.floor(s/1.6)}px Courier New`,r.value.textAlign="center",r.value.textBaseline="middle";const e=["#000000","#1414c8","#14c828","#c82832","#b48228","#aa28aa","#28aaaa","#000000","#000000"];for(let t=0;t<i.rows;t++)for(let n=0;n<i.columns;n++){const a=i.grid[t][n],u=n*s,o=t*s;if(r.value.fillStyle=x("--theme-canvas-bg")||(S.isDarkMode?"#4a4a4a":"#eeeeee"),r.value.fillRect(u+1,o+1,s-2,s-2),a.isShown&&(r.value.fillStyle=x("--theme-mine-revealed")||(S.isDarkMode?"#9aa19a":"#dfeae0"),r.value.fillRect(u+1,o+1,s-2,s-2)),a.isMarked&&(r.value.fillStyle=x("--theme-mine-flag")||(S.isDarkMode?"#9aa19a":"#dfeae0"),r.value.beginPath(),r.value.arc(u+s/2,o+s/2,s/3,0,Math.PI*2),r.value.fill()),a.isMine&&(i.showMines||a.isShown)&&(r.value.fillStyle=x("--theme-mine-bg")||"#ff4d6d",r.value.beginPath(),r.value.arc(u+s/2,o+s/2,s/3,0,Math.PI*2),r.value.fill()),a.isShown&&!a.isMine){const c=a.neighbors.filter(k=>k.isMine).length;c>0&&(r.value.fillStyle=e[c],r.value.fillText(c,u+s/2,o+s/2))}}r.value.restore()}function Y(s){const e=(s-j)/1e3;j=s,i.gameStatus===0&&(i.time+=e),W(),F=requestAnimationFrame(Y)}function ue(s){const e=d.value.getBoundingClientRect(),t=(s.clientX-e.left)/e.width,n=(s.clientY-e.top)/e.height,a=Math.floor(t*i.columns),u=Math.floor(n*i.rows),o=i.grid[u][a];i.act(o,s.button),s.preventDefault()}function de(){v.value!=="custom"&&(P(),M())}return fe(()=>{r.value=d.value.getContext("2d"),P(),M(),window.addEventListener("resize",_),F=requestAnimationFrame(Y)}),ve(()=>{window.removeEventListener("resize",_),cancelAnimationFrame(F)}),(s,e)=>(y(),w("div",{class:Z(["app",{"dark-mode":ye(S).isDarkMode}])},[e[15]||(e[15]=l("h1",{class:"game-header"},"Minesweeper",-1)),l("div",Se,[l("div",xe,[l("div",ke,[e[7]||(e[7]=l("label",{for:"difficulty-select",class:"form-label"},"SvÃ¥righetsgrad",-1)),C(l("select",{id:"difficulty-select","onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),onChange:de,class:"form-select"},[(y(),w(ge,null,Me($,t=>l("option",{key:t.id,value:t.id},H(t.label),9,Ce)),64)),e[6]||(e[6]=l("option",{value:"custom"},"Custom",-1))],544),[[pe,v.value]])])]),L(q,{name:"fade"},{default:B(()=>[v.value==="custom"?(y(),w("div",Te,[l("label",null,[e[8]||(e[8]=U(" Width ",-1)),C(l("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),min:z,max:D},null,512),[[V,h.value,void 0,{number:!0}]])]),l("label",null,[e[9]||(e[9]=U(" Height ",-1)),C(l("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=t=>m.value=t),min:z,max:D},null,512),[[V,m.value,void 0,{number:!0}]])]),l("label",null,[e[10]||(e[10]=U(" Mines ",-1)),C(l("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t),min:1,max:h.value*m.value-1},null,8,_e),[[V,g.value,void 0,{number:!0}]])]),l("button",{class:"btn",onClick:A(oe,["prevent"])},"Skapa")])):N("",!0)]),_:1}),l("div",Re,[l("button",{class:"btn",disabled:I.value===-1,onClick:M},"ðŸ”„ Restart",8,Ne),l("button",{class:"btn seed",onClick:le},"ðŸŽ² New seed")]),l("div",Ve,[l("div",null,[e[11]||(e[11]=l("label",{for:"seed-input"},"Seed:",-1)),C(l("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>p.value=t),type:"text"},null,512),[[V,p.value]])]),l("div",Ae,[l("button",{class:"btn",onClick:A(ae,["prevent"])},"AnvÃ¤nd"),l("div",ze,[E.value?(y(),w("div",De,"Seed kopierad!")):N("",!0),l("button",{class:"btn",onClick:A(re,["prevent"])},"Kopiera")])])])]),l("section",Ee,[l("p",null,"Time: "+H(te.value.toFixed(2))+"s",1),l("p",null,"Mines: "+H(ee.value),1),l("div",Fe,[e[12]||(e[12]=l("span",null,"Cleared",-1)),l("div",Ie,[l("div",{class:Z(["bar__inner",{cleared:K.value===100}]),style:we({width:K.value+"%"})},null,6)])])]),l("div",Pe,[l("canvas",{ref_key:"canvas",ref:d,onMousedown:ue,onContextmenu:e[5]||(e[5]=A(()=>{},["prevent"]))},null,544),L(q,{name:"fade"},{default:B(()=>[I.value===1?(y(),w("div",We,[e[13]||(e[13]=l("span",null,"ðŸŽ‰ Enkel Vinst!",-1)),l("button",{class:"btn",onClick:M},"Spela igen")])):N("",!0)]),_:1}),L(q,{name:"fade"},{default:B(()=>[I.value===2?(y(),w("div",Le,[e[14]||(e[14]=l("span",null,"ðŸ’¥ Du fÃ¶rlorade!",-1)),l("button",{class:"btn",onClick:M},"Spela igen")])):N("",!0)]),_:1})])],2))}},$e=ce(Ue,[["__scopeId","data-v-a58e0ca4"]]);export{$e as default};
