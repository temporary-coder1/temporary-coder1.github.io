import{I as J,c as v,y as w,b as e,h as r,_ as R,A as ee,B as ve,r as u,F as x,C as U,d as b,D as fe,t as i,z as W,f as pe,s as N,v as me,e as ge,j,o as ke,a as he,w as be,p as G,x as ye}from"./index-D0mw0nTW.js";const Se=J({__name:"Cell",props:{isClicked:{type:Boolean,required:!0},state:{type:Number,default:0},isHardMode:{type:Boolean,default:!1}},emits:["pressed"],setup(c,{emit:f}){const a=f;return(n,p)=>(r(),v("div",{class:w(["cell",{highlighted:c.isClicked}]),onClick:p[0]||(p[0]=k=>a("pressed"))},[e("div",{class:w(["lamp",{"state-1":c.state===1,"state-2":c.state===2&&c.isHardMode}])},null,2)],2))}}),Ce=R(Se,[["__scopeId","data-v-57681c82"]]);function _e(c,f,a){const n=we(a);return c*3+f**2+n*7-13}function we(c){const f="0123456789abcdefghijklmnopqrstuvwxyz";c=(c||"").toLowerCase().slice(0,3);let a=0;for(const n of c){const p=f.indexOf(n);if(p<0)return 0;a=a*36+p}return a}async function Me(c="n",f=300){const{data:a,error:n}=await ee.from("lightout_scores").select("playerID, score, clicks, seed, date, difficulty").eq("difficulty",c).order("score",{ascending:!1}).order("clicks",{ascending:!0}).limit(f);return n?(console.error("Error fetching Lights Out scores:",n),[]):a}async function X(c){const f={...c,key:_e(c.score,c.clicks,c.seed)},{data:a,error:n}=await ee.functions.invoke("lightsout/submit",{method:"POST",body:JSON.stringify(f)});if(n)throw console.error("Error submitting Lights Out score:",n),n;return a}const $e={class:"modal-content"},Le={key:0},Oe={key:1},De={key:2},Ie={key:3},Ne={key:4},Ae={key:5,class:"score-save-options"},Te={key:0,class:"auth-user-options"},Be={class:"save-prompt"},xe={key:1,class:"unauth-user-options"},He={class:"button-group-inline"},Fe={key:1,class:"guest-form-overlay"},je={class:"button-group"},ze=["disabled"],Ke={key:0,class:"error-message"},Pe=J({__name:"SaveLightsOutScore",props:{score:{},clicks:{},seed:{},difficulty:{},gameOver:{type:Boolean}},emits:["close","saved"],setup(c,{emit:f}){const a=ve(),n=c,p=f,k=u(""),_=u(!1),S=u(!1),M=u(!0),C=u(""),h=u(!1),y=u("");function L(){M.value=!1}async function O(){try{const d=a.profile?.username||a.user?.email||"User";await X({playerID:d,score:n.score,clicks:n.clicks,seed:n.seed,difficulty:n.difficulty}),p("saved"),p("close")}catch{y.value="Kunde inte spara poäng"}}function m(d){C.value=d,S.value=!0}function H(){S.value=!1,C.value=""}function z(){H()}function A(){_.value=!0}function T(){_.value=!1}async function K(){if(!h.value){if(!k.value.trim()){y.value="Visningsnamn är obligatoriskt";return}h.value=!0,y.value="";try{await X({playerID:k.value.trim(),score:n.score,clicks:n.clicks,seed:n.seed,difficulty:n.difficulty}),p("saved"),p("close")}catch{y.value="Nätverksfel - försök igen senare"}finally{h.value=!1}}}return(d,g)=>(r(),v(x,null,[S.value?(r(),U(fe,{key:0,mode:C.value,onClose:H,onSuccess:z,class:"auth-form"},null,8,["mode"])):b("",!0),e("div",$e,[d.gameOver?(r(),v("h2",Le,"Bra kämpat!")):b("",!0),d.gameOver?(r(),v("h3",Oe,"Spara dina poäng?")):b("",!0),d.gameOver?(r(),v("p",De,"Poäng: "+i(d.score),1)):b("",!0),d.gameOver?(r(),v("p",Ie,"Klickar: "+i(d.clicks),1)):b("",!0),d.gameOver?(r(),v("p",Ne,"Seed: "+i(d.seed),1)):b("",!0),d.gameOver&&d.score>0&&M.value?(r(),v("div",Ae,[W(a).isAuthed?(r(),v("div",Te,[e("p",Be,"Spara som "+i(W(a).profile?.username||"Användare")+"?",1),e("div",{class:"button-group-inline"},[e("button",{onClick:L,class:"btn-decline"},"Nej Tack"),e("button",{onClick:O,class:"btn-save"},"Spara Poäng")])])):(r(),v("div",xe,[g[4]||(g[4]=e("p",{class:"save-prompt"},"Spara din poäng?",-1)),e("div",He,[e("button",{onClick:g[0]||(g[0]=D=>m("login")),class:"btn-auth"},"Logga In"),e("button",{onClick:g[1]||(g[1]=D=>m("signup")),class:"btn-auth"},"Skapa Konto"),e("button",{onClick:A,class:"btn-guest"},"Som Gäst")]),e("button",{onClick:L,class:"btn-decline-full"},"Nej Tack")]))])):b("",!0),e("button",{onClick:g[2]||(g[2]=D=>d.$emit("close")),class:"btn-modal-action"},"Stäng")]),_.value?(r(),v("div",Fe,[e("form",{onSubmit:ge(K,["prevent"]),class:"guest-form-modal"},[e("button",{type:"button",class:"close-form-button",onClick:T},"×"),g[5]||(g[5]=e("h2",null,"Spara som Gäst",-1)),g[6]||(g[6]=e("label",{for:"playerID-input",class:"form-label"},[e("abbr",{title:"","data-title":"Syns i topplistan för andra."},[N(" Visningsnamn"),e("span",{style:{color:"red"}},"*")])],-1)),pe(e("input",{type:"text",id:"playerID-input","onUpdate:modelValue":g[3]||(g[3]=D=>k.value=D),placeholder:"Ditt visningsnamn",class:"form-input",required:""},null,512),[[me,k.value]]),e("div",je,[e("button",{type:"button",class:"submit-button decline",onClick:T},"Avbryt"),e("button",{type:"submit",class:"submit-button primary",disabled:h.value},i(h.value?"Sparar...":"Spara!"),9,ze)]),y.value?(r(),v("div",Ke,i(y.value),1)):b("",!0)],32)])):b("",!0)],64))}}),Ve=R(Pe,[["__scopeId","data-v-08a1c912"]]),qe={class:"app-container"},Ee={class:"settings"},Ge={class:"sub-setting"},Ue={class:"clicks"},Je={class:"score"},Re={class:"timeLeft"},Qe={class:"sub-setting"},We=["value"],Xe={class:"leaderboard-container"},Ye={class:"leaderboard-content"},Ze={class:"leaderboard-table"},et={class:"seed-row"},tt={colspan:"6"},st={class:"seed-row__content"},lt={class:"seed-tag"},at={class:"seed-meta"},nt=["onClick"],ot={class:"rank"},rt={class:"col-seed"},it={class:"col-date"},ut={class:"game-wrapper"},ct={class:"difficulty-toggle"},dt={class:"game-help"},vt={class:"help-wrapper"},ft={class:"help-content"},pt={key:0},mt={key:1},Y=180*1e3,Z="0123456789abcdefghijklmnopqrstuvwxyz",gt=J({__name:"LightsOut",setup(c){const f=u([]),a=u(5),n=u(5),p=u("000"),k=u(0),_=u(0),S=u(0),M=u(Y),C=u(null),h=u(!1),y=u(!1),L=u([]),O=u(!1),m=u(!1),H=j(()=>{const s=Math.max(0,M.value),t=Math.floor(s/6e4),l=Math.floor(s%6e4/1e3);return`${t}:${l.toString().padStart(2,"0")}`});function z(){if(C.value!==null||h.value)return;const s=Date.now()+M.value;C.value=window.setInterval(()=>{const t=s-Date.now();M.value=t>0?t:0,t<=0&&(A(),h.value=!0)},250)}function A(){C.value!==null&&(window.clearInterval(C.value),C.value=null)}function T(s,t=3){s=Math.max(0,Math.floor(s))%Math.pow(36,t);let l="";do l=Z[s%36]+l,s=Math.floor(s/36);while(s>0);return l.padStart(t,"0")}function K(s){s=(s||"").toLowerCase().slice(0,3);let t=0;for(const l of s){const o=Z.indexOf(l);if(o<0)return 0;t=t*36+o}return t}function d(s){return(s||"").toLowerCase().replace(/[^0-9a-z]/g,"").slice(0,3)}function g(s){const t=s.target;p.value=d(t.value)}function D(s){p.value=d(s),B()}const te=j(()=>f.value.filter(s=>s.state>0).length),se=j(()=>m.value?3:2);function le(s,t){if(s<0||s>=n.value||t<0||t>=a.value)return;const l=s*a.value+t,o=f.value[l];o.state=(o.state+1)%se.value}function ae(s){h.value||(C.value===null&&z(),_.value++,f.value.forEach(t=>t.isClicked=!1),f.value[s].isClicked=!0,P(s),ne())}function P(s){const t=Math.floor(s/a.value),l=s%a.value,o=[[0,0],[0,1],[0,-1],[1,0],[-1,0]];for(const[q,F]of o)le(t+q,l+F)}function ne(){te.value<=0&&(S.value++,Q())}async function Q(){k.value=k.value+5,console.log("Next Level Seed:",T(k.value)),f.value=Array.from({length:n.value*a.value},()=>({isClicked:!1,state:0}));const s=3+S.value*2;for(let t=0;t<s;t++){const l=Math.floor((k.value+t)*Math.sqrt((t+1)*3)%(a.value*n.value));P(l)}}function oe(){f.value=Array.from({length:n.value*a.value},()=>({isClicked:!1,state:0}));const s=3+S.value*2;for(let t=0;t<s;t++){const l=Math.floor((k.value+t)*Math.sqrt((t+1)*3)%(a.value*n.value));P(l)}}function B(){k.value=K(p.value),A(),M.value=Y,h.value=!1,S.value=0,_.value=0,O.value=!1,Q()}function re(){m.value=!m.value,B(),V()}ke(()=>{const s=Math.floor(Math.random()*Math.pow(36,3));p.value=T(s,3),B(),V()}),he(()=>{A()});const ie=j(()=>{const s=new Map;for(const l of L.value)s.has(l.seed)||s.set(l.seed,[]),s.get(l.seed).push(l);const t=[];for(const[l,o]of s.entries()){const F=[...o].sort(($,I)=>I.score!==$.score?I.score-$.score:$.clicks-I.clicks).slice(0,3),de=F.map(($,I)=>({...$,rank:I+1,key:`${$.playerID}-${$.date}-${I}`})),E=F[0];E&&t.push({seed:l,entries:de,best:{score:E.score,clicks:E.clicks}})}return t.sort((l,o)=>o.best.score!==l.best.score?o.best.score-l.best.score:l.best.clicks-o.best.clicks),t});async function V(){L.value=await Me(m.value?"h":"n"),console.log("Fetched leaderboard:",L.value)}function ue(){y.value=!y.value}function ce(s){try{return new Date(s).toLocaleDateString()}catch{return s}}return be(h,s=>{s&&(O.value=!0)}),(s,t)=>(r(),v("div",qe,[t[19]||(t[19]=e("h1",null,"Lights Out",-1)),e("div",Ee,[e("div",Ge,[e("span",Ue,"Klickar: "+i(_.value),1),e("span",Je,"Poäng: "+i(S.value),1),e("span",Re,"Tid kvar: "+i(H.value),1),e("span",{class:w(["difficulty-indicator",{"hard-mode":m.value}])},i(m.value?"🔥 Hard":"Normal"),3)]),e("div",Qe,[e("div",{class:"seed-label"},[t[1]||(t[1]=e("label",{for:"seedCode"},[e("strong",null,"Seed:")],-1)),e("button",{onClick:B},"Använd")]),e("input",{id:"seedCode",type:"text",value:p.value,onInput:g,placeholder:"a1b",maxlength:"3"},null,40,We),e("button",{onClick:oe,class:"restart-btn",title:"Starta om nivån","aria-label":"Starta om nivån"}," ↻ Nivå "),e("button",{onClick:B,class:"restart-btn entire-game-btn",title:"Starta om spelet","aria-label":"Starta om spelet"}," ↻ Spel ")])]),e("div",Xe,[e("button",{onClick:ue,class:"leaderboard-toggle"},[e("span",null,"🏆 Topplista "+i(m.value?"(Hard Mode)":"(Normal)"),1),e("span",{class:w(["toggle-icon",{expanded:y.value}])},"▼",2)]),e("div",{class:w(["leaderboard-wrapper",{expanded:y.value}])},[e("div",Ye,[e("table",Ze,[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Spelare"),e("th",null,"Poäng"),e("th",null,"Klickar"),e("th",null,"Seed"),e("th",null,"Datum")])],-1)),e("tbody",null,[(r(!0),v(x,null,G(ie.value,l=>(r(),v(x,{key:l.seed},[e("tr",et,[e("td",tt,[e("div",st,[e("span",lt,[t[2]||(t[2]=N("Seed: ",-1)),e("strong",null,i(l.seed),1)]),e("span",at,[t[3]||(t[3]=N("Bäst: ",-1)),e("strong",null,i(l.best.score),1),t[4]||(t[4]=N("p • ",-1)),e("strong",null,i(l.best.clicks),1),t[5]||(t[5]=N(" klickar",-1))]),e("button",{class:"seed-row__btn",onClick:o=>D(l.seed)}," Använd seed ",8,nt)])])]),(r(!0),v(x,null,G(l.entries,o=>(r(),v("tr",{key:o.key,class:w(["leaderboard-row",`rank-${o.rank}`])},[e("td",ot,i(o.rank),1),e("td",null,i(o.playerID),1),e("td",null,i(o.score),1),e("td",null,i(o.clicks),1),e("td",rt,i(l.seed),1),e("td",it,i(ce(o.date)),1)],2))),128))],64))),128))])])])],2)]),e("div",ut,[e("div",{class:w(["game-container",{"hard-mode":m.value}]),style:ye({gridTemplateColumns:`repeat(${a.value}, 1fr)`})},[(r(!0),v(x,null,G(f.value,(l,o)=>(r(),U(Ce,{key:o,isClicked:l.isClicked,state:l.state,isHardMode:m.value,onPressed:q=>ae(o)},null,8,["isClicked","state","isHardMode","onPressed"]))),128))],6)]),e("div",ct,[e("button",{onClick:re,class:w(["difficulty-btn",{"hard-active":m.value}])},i(m.value?"🔥 Hard Mode":"Normal Mode"),3)]),O.value?(r(),U(Ve,{key:0,score:S.value,clicks:_.value,seed:p.value,difficulty:m.value?"h":"n",gameOver:h.value,onClose:t[0]||(t[0]=l=>O.value=!1),onSaved:V},null,8,["score","clicks","seed","difficulty","gameOver"])):b("",!0),e("details",dt,[t[18]||(t[18]=e("summary",{class:"help-label"},[e("span",null,"Hur funkar spelet?"),e("span",{class:"toggle-icon"},"▼")],-1)),e("div",vt,[e("div",ft,[t[11]||(t[11]=e("h3",null,"Målet",-1)),t[12]||(t[12]=e("p",null," Släck alla lampor på brädet innan tiden (3:00) tar slut. Varje löst bräda ger poäng och nästa nivå blir lite svårare. ",-1)),t[13]||(t[13]=e("h3",null,"Så spelar du",-1)),e("ul",null,[m.value?b("",!0):(r(),v("li",pt," Klicka på en ruta för att tända/släcka den och dess grannar (upp, ner, vänster, höger). ")),m.value?(r(),v("li",mt,[...t[7]||(t[7]=[e("strong",null,"Hard Mode:",-1),N(" Klicka på en ruta för att ändra tillstånd (av → gul → blå → av) på den och dess grannar. Alla lampor måste vara av för att vinna. ",-1)])])):b("",!0),t[8]||(t[8]=e("li",null,"Tiden börjar först när du gör ditt första klick.",-1)),t[9]||(t[9]=e("li",null," Du kan starta om nuvarande nivå (↻ Nivå) eller hela spelet (↻ Spel) när du vill. ",-1)),t[10]||(t[10]=e("li",null,"Växla mellan Normal och Hard Mode med knappen under spelet.",-1))]),t[14]||(t[14]=e("h3",null,"Seed & nivåer",-1)),t[15]||(t[15]=e("p",null," Spelet använder en seed-kod (3 tecken: 0-9, a-z). Samma seed ger samma nivåer. Nivåerna skapas genom att spelet gör ett antal drag från ett tomt bräde, vilket gör att de alltid går att lösa. ",-1)),t[16]||(t[16]=e("h3",null,"Topplista",-1)),t[17]||(t[17]=e("p",null," När tiden är slut kan du spara din poäng och tävla mot andra. Topplistan grupperar resultat per seed och jämför poäng och antal klick. ",-1))])])])]))}}),ht=R(gt,[["__scopeId","data-v-a33d0091"]]);export{ht as default};
