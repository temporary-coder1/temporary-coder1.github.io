import{u as P,r as d,w as I,o as N,n as X,a as Y,c as k,b as l,d as g,t as v,e as U,f as O,v as J,g as K,h as C}from"./index-CVO9u6ab.js";class y{constructor(e=0){this.value=e}draw(e,t,a,s,n,c){const h=c[this.value]||c.default;e.fillStyle=h[0],e.fillRect(t+n,a+n,s-n,s-n),this.value>0&&(e.fillStyle=this.value<=4?"#776e65":"#f9f6f2",e.font=`${Math.floor(s/2.5)}px 'Segoe UI', Arial, sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(this.value,t+n/2+s/2,a+n/2+s/2))}}class ${constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.ratio=window.devicePixelRatio||1,this.board=[],this.score=0,this.rows=4,this.columns=4,this.tileSize=100,this.gap=4,this.canvasWidth=0,this.canvasHeight=0,this.darkMode=!1,this.useClassicColors=!1,this.onScoreUpdate=null,this.onGameOver=null,this.setupColors()}setupColors(){this.classicColors={0:["#cdc1b5","#5c5c5e"],2:["#eee4da","#bbada0"],4:["#ece0ca","#a39489"],8:["#f4b17a","#f5ac5f"],16:["#f59575","#f68d5b"],32:["#f57c5f","#e65d3b"],64:["#f65d3b","#c83410"],128:["#edce71","#edc850"],256:["#edcc63","#edc53f"],512:["#edc651","#eec744"],1024:["#eec744","#ecc230"],2048:["#ecc230","#e6b800"],4096:["#3cb371","#2e8b57"],8192:["#2e8b57","#228b22"],16384:["#228b22","#006400"],32768:["#006400","#004d00"],65536:["#4682b4","#4169e1"],131072:["#4169e1","#0000ff"],262144:["#0000ff","#00008b"],524288:["#00008b","#00004b"],default:["#3c3a32","#cdc1b5"]},this.kfkbColors={0:["#e8f5e8","#374151"],2:["#c8e6c9","#4b5563"],4:["#a5d6a7","#6b7280"],8:["#81c784","#16a34a"],16:["#66bb6a","#15803d"],32:["#4caf50","#166534"],64:["#43a047","#14532d"],128:["#388e3c","#365314"],256:["#2e7d32","#1a2e05"],512:["#1b5e20","#0f172a"],1024:["#0d3b12","#020617"],2048:["#09270c","#000000"],4096:["#061b08","#000000"],8192:["#041204","#000000"],16384:["#020a02","#000000"],32768:["#000000","#000000"],65536:["#000000","#000000"],131072:["#000000","#000000"],262144:["#000000","#000000"],524288:["#000000","#000000"],default:["#f8fafc","#374151"]}}setDarkMode(e){this.darkMode=e}setUseClassicColors(e){this.useClassicColors=e}setBoardSize(e,t){this.rows=e,this.columns=t}initGame(){this.board=Array.from({length:this.rows},()=>Array(this.columns).fill(null).map(()=>new y)),this.score=0,this.addRandomTile(),this.addRandomTile(),this.resizeBoard(),this.onScoreUpdate&&this.onScoreUpdate(this.score)}resetGame(){this.score=0,this.initGame()}resizeBoard(){const e=Math.min(window.innerWidth*.9,600),t=Math.min(window.innerHeight*.6,600);this.tileSize=Math.min(e/this.columns,t/this.rows)-this.gap*2/this.rows,this.canvasWidth=this.tileSize*this.columns+this.gap,this.canvasHeight=this.tileSize*this.rows+this.gap,this.canvas.width=this.canvasWidth*this.ratio,this.canvas.height=this.canvasHeight*this.ratio,this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0),this.canvas.style.width=`${this.canvasWidth}px`,this.canvas.style.height=`${this.canvasHeight}px`,this.board&&this.board.length>0&&this.drawBoard()}drawBoard(){if(!this.board||this.board.length===0)return;const e=this.useClassicColors?this.classicColors:this.kfkbColors;this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight);const t=getComputedStyle(document.documentElement);this.ctx.fillStyle=this.useClassicColors?t.getPropertyValue("--theme-canvas-2048-bg").trim()||(this.darkMode?"#2d2520":"#bbada0"):t.getPropertyValue("--theme-canvas-bg").trim()||(this.darkMode?"#1f2937":"#f8fafc"),this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.strokeStyle=t.getPropertyValue("--theme-canvas-border").trim()||(this.darkMode?"#4b5563":"#d1d5db"),this.ctx.lineWidth=this.gap*this.ratio,this.ctx.strokeRect(0,0,this.canvasWidth,this.canvasHeight);for(let a=0;a<this.rows;a++)for(let s=0;s<this.columns;s++)if(this.board[a]&&this.board[a][s]){const n=s*this.tileSize,c=a*this.tileSize;this.darkMode;const h={...e,0:[this.darkMode?e[0][1]:e[0][0],e[0][1]],default:[this.darkMode?e.default[1]:e.default[0],e.default[1]]};this.board[a][s].draw(this.ctx,n,c,this.tileSize,this.gap,h)}this.onScoreUpdate&&this.onScoreUpdate(this.score)}addRandomTile(){const e=[];for(let t=0;t<this.rows;t++)for(let a=0;a<this.columns;a++)this.board[t][a].value===0&&e.push({r:t,c:a});if(e.length===0&&this.checkGameOver()&&this.onGameOver){this.onGameOver();return}if(e.length>0){const{r:t,c:a}=e[Math.floor(Math.random()*e.length)];this.board[t][a].value=Math.random()<.9?2:4}}checkGameOver(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)if(this.board[e][t].value===0)return!1;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++){const a=this.board[e][t].value;if(t<this.columns-1&&a===this.board[e][t+1].value||e<this.rows-1&&a===this.board[e+1][t].value)return!1}return!0}slide(e){const t=e.filter(s=>s.value!==0);for(let s=0;s<t.length-1;s++)t[s].value===t[s+1].value&&(t[s].value*=2,this.score+=t[s].value,t[s+1].value=0);const a=t.filter(s=>s.value!==0);for(;a.length<this.columns;)a.push(new y);return a}slideLeft(){for(let e=0;e<this.rows;e++)this.board[e]=this.slide(this.board[e]);this.addRandomTile(),this.drawBoard()}slideRight(){for(let e=0;e<this.rows;e++)this.board[e].reverse(),this.board[e]=this.slide(this.board[e]),this.board[e].reverse();this.addRandomTile(),this.drawBoard()}slideUp(){for(let e=0;e<this.columns;e++){const t=this.board.map(s=>s[e]),a=this.slide(t);for(let s=0;s<this.rows;s++)this.board[s][e]=a[s]}this.addRandomTile(),this.drawBoard()}slideDown(){for(let e=0;e<this.columns;e++){const t=this.board.map(s=>s[e]);t.reverse();const a=this.slide(t);a.reverse();for(let s=0;s<this.rows;s++)this.board[s][e]=a[s]}this.addRandomTile(),this.drawBoard()}saveGame(){const e={board:this.board.map(t=>t.map(a=>a.value)),score:this.score,rows:this.rows,columns:this.columns};localStorage.setItem("2048GameState",JSON.stringify(e))}loadGame(){const e=localStorage.getItem("2048GameState");if(e)try{const t=JSON.parse(e);return this.rows=t.rows,this.columns=t.columns,this.score=t.score,this.board=t.board.map(a=>a.map(s=>new y(s))),this.resizeBoard(),t}catch(t){return console.error("Error loading game state:",t),null}return null}}const F={class:"game-2048"},j={class:"score-display"},q={class:"score-value"},Q={class:"game-settings"},Z={class:"board-size-control"},ee={for:"board-size-slider"},te={class:"slider-container"},se={class:"settings-toggles"},ae={class:"checkbox-container"},oe={key:0,class:"load-game-section"},ie={class:"saved-game-info"},re={class:"game-container"},le={key:0,class:"game-over-modal"},ne={class:"modal-content"},ce={__name:"2048",setup(M){const e=P(),t=d(null),a=d(0),s=d(!1),n=d(4),c=d(4),h=d(4),m=d(!1),b=d(!1),G=d(0),T=d(0),x=d(0);let r=null;function z(){t.value&&(r=new $(t.value),r.setDarkMode(e.isDarkMode),r.setUseClassicColors(m.value),r.onScoreUpdate=i=>{a.value=i},r.onGameOver=()=>{s.value=!0},r.setBoardSize(n.value,c.value),r.initGame(),W())}function L(){const i=parseInt(h.value);i>=2&&i<=10&&(n.value=i,c.value=i,p())}function p(){s.value=!1,a.value=0,r&&(r.setBoardSize(n.value,c.value),r.resetGame()),b.value=!1}function _(){r&&(r.setUseClassicColors(m.value),r.drawBoard())}function f(){r&&r.saveGame()}function E(){if(r){const i=r.loadGame();i&&(n.value=i.rows,c.value=i.columns,h.value=i.rows,a.value=i.score,s.value=!1,b.value=!1)}}function W(){const i=localStorage.getItem("2048GameState");if(i){const o=JSON.parse(i);o.score>0&&(b.value=!0,G.value=o.score)}}function A(i){i.preventDefault(),i.stopPropagation();const o=i.touches[0]||i.changedTouches[0];T.value=o.clientX,x.value=o.clientY}function H(i){if(i.preventDefault(),i.stopPropagation(),!r||s.value)return;const o=i.changedTouches[0],u=o.clientX,V=o.clientY,w=u-T.value,S=V-x.value,R=30;Math.abs(w)<R&&Math.abs(S)<R||(Math.abs(w)>Math.abs(S)?w>0?r.slideRight():r.slideLeft():S>0?r.slideDown():r.slideUp(),f())}function B(i){if(!(!r||s.value))switch(i.code){case"ArrowLeft":i.preventDefault(),r.slideLeft(),f();break;case"ArrowRight":i.preventDefault(),r.slideRight(),f();break;case"ArrowUp":i.preventDefault(),r.slideUp(),f();break;case"ArrowDown":i.preventDefault(),r.slideDown(),f();break}}function D(){r&&r.resizeBoard()}return I(()=>e.isDarkMode,i=>{r&&(r.setDarkMode(i),r.drawBoard())}),N(async()=>{await X(),t.value?z():setTimeout(()=>{t.value&&z()},100),document.addEventListener("keydown",B),window.addEventListener("resize",D)}),Y(()=>{document.removeEventListener("keydown",B),window.removeEventListener("resize",D)}),(i,o)=>(C(),k("div",F,[l("div",null,[o[4]||(o[4]=l("h1",{class:"game-header"},"2048",-1)),l("div",j,[o[3]||(o[3]=g(" Poäng: ",-1)),l("span",q,v(a.value),1)])]),l("div",Q,[l("div",Z,[l("label",ee,[o[5]||(o[5]=g(" Storlek (",-1)),l("span",null,v(n.value)+" x "+v(c.value),1),o[6]||(o[6]=g(") ",-1))]),l("div",te,[o[7]||(o[7]=l("span",{class:"slider-min"},"2",-1)),O(l("input",{id:"board-size-slider","onUpdate:modelValue":o[0]||(o[0]=u=>h.value=u),type:"range",min:"2",max:"10",class:"board-size-slider",onInput:L},null,544),[[J,h.value]]),o[8]||(o[8]=l("span",{class:"slider-max"},"10",-1))])]),l("div",se,[l("label",ae,[O(l("input",{"onUpdate:modelValue":o[1]||(o[1]=u=>m.value=u),type:"checkbox",onChange:_},null,544),[[K,m.value]]),o[9]||(o[9]=l("span",{class:"checkmark"},null,-1)),o[10]||(o[10]=g(" Klassiska färger ",-1))])]),b.value?(C(),k("div",oe,[l("div",ie," Ladda ditt sparade spel? Du hade "+v(G.value)+" poäng ",1),l("button",{class:"action-button load-button",onClick:E},"Ladda Spel")])):U("",!0),l("button",{class:"action-button restart-button",onClick:p},"Starta Om")]),l("div",re,[l("canvas",{ref_key:"gameCanvas",ref:t,class:"game-canvas",tabindex:"0",onTouchstart:A,onTouchend:H,onTouchmove:o[2]||(o[2]=u=>u.preventDefault())},null,544),s.value?(C(),k("div",le,[l("div",ne,[o[11]||(o[11]=l("h2",null,"Spelet är slut!",-1)),l("p",null,"Din slutpoäng: "+v(a.value),1),l("button",{class:"action-button",onClick:p},"Starta Om")])])):U("",!0)]),o[12]||(o[12]=l("div",{class:"game-instructions"},[l("p",null,"Använd piltangenterna för att flytta brickorna. Kombinera lika nummer för att nå 2048!")],-1))]))}};export{ce as default};
