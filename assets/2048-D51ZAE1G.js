import{u as P,r as c,w as V,o as $,n as X,a as Y,c as w,b as a,d as M,t as b,e as F,f as I,v as J,g as j,h as S}from"./index-CIJZ9MWw.js";class G{constructor(e=0){this.value=e}draw(e,t,i,s,d,h){const u=h[this.value]||h.default;e.fillStyle=u[0],e.fillRect(t+d,i+d,s-d,s-d),this.value>0&&(e.fillStyle=this.value<=4?"#776e65":"#f9f6f2",e.font=`${Math.floor(s/2.5)}px 'Segoe UI', Arial, sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(this.value,t+d/2+s/2,i+d/2+s/2))}}class K{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.ratio=window.devicePixelRatio||1,this.board=[],this.score=0,this.rows=4,this.columns=4,this.tileSize=100,this.gap=4,this.canvasWidth=0,this.canvasHeight=0,this.darkMode=!1,this.useClassicColors=!1,this.onScoreUpdate=null,this.onGameOver=null,this.setupColors()}setupColors(){this.classicColors={0:["#cdc1b5","#5c5c5e"],2:["#eee4da","#bbada0"],4:["#ece0ca","#a39489"],8:["#f4b17a","#f5ac5f"],16:["#f59575","#f68d5b"],32:["#f57c5f","#e65d3b"],64:["#f65d3b","#c83410"],128:["#edce71","#edc850"],256:["#edcc63","#edc53f"],512:["#edc651","#eec744"],1024:["#eec744","#ecc230"],2048:["#ecc230","#e6b800"],4096:["#3cb371","#2e8b57"],8192:["#2e8b57","#228b22"],16384:["#228b22","#006400"],32768:["#006400","#004d00"],65536:["#4682b4","#4169e1"],131072:["#4169e1","#0000ff"],262144:["#0000ff","#00008b"],524288:["#00008b","#00004b"],default:["#3c3a32","#cdc1b5"]},this.kfkbColors={0:["#e8f5e8","#374151"],2:["#c8e6c9","#4b5563"],4:["#a5d6a7","#6b7280"],8:["#81c784","#16a34a"],16:["#66bb6a","#15803d"],32:["#4caf50","#166534"],64:["#43a047","#14532d"],128:["#388e3c","#365314"],256:["#2e7d32","#1a2e05"],512:["#1b5e20","#0f172a"],1024:["#0d3b12","#020617"],2048:["#09270c","#000000"],4096:["#061b08","#000000"],8192:["#041204","#000000"],16384:["#020a02","#000000"],32768:["#000000","#000000"],65536:["#000000","#000000"],131072:["#000000","#000000"],262144:["#000000","#000000"],524288:["#000000","#000000"],default:["#f8fafc","#374151"]}}setDarkMode(e){this.darkMode=e}setUseClassicColors(e){this.useClassicColors=e}setBoardSize(e,t){this.rows=e,this.columns=t}initGame(){this.board=Array.from({length:this.rows},()=>Array(this.columns).fill(null).map(()=>new G)),this.score=0,this.addRandomTile(),this.addRandomTile(),this.resizeBoard(),this.onScoreUpdate&&this.onScoreUpdate(this.score)}resetGame(){this.score=0,this.initGame()}resizeBoard(){const e=Math.min(window.innerWidth*.9,600),t=Math.min(window.innerHeight*.6,600);this.tileSize=Math.min(e/this.columns,t/this.rows)-this.gap*2/this.rows,this.canvasWidth=this.tileSize*this.columns+this.gap,this.canvasHeight=this.tileSize*this.rows+this.gap,this.canvas.width=this.canvasWidth*this.ratio,this.canvas.height=this.canvasHeight*this.ratio,this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0),this.canvas.style.width=`${this.canvasWidth}px`,this.canvas.style.height=`${this.canvasHeight}px`,this.board&&this.board.length>0&&this.drawBoard()}drawBoard(){if(!this.board||this.board.length===0)return;const e=this.useClassicColors?this.classicColors:this.kfkbColors;this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight);const t=getComputedStyle(document.documentElement);this.ctx.fillStyle=this.useClassicColors?t.getPropertyValue("--theme-canvas-2048-bg").trim()||(this.darkMode?"#2d2520":"#bbada0"):t.getPropertyValue("--theme-canvas-bg").trim()||(this.darkMode?"#1f2937":"#f8fafc"),this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.strokeStyle=t.getPropertyValue("--theme-canvas-border").trim()||(this.darkMode?"#4b5563":"#d1d5db"),this.ctx.lineWidth=this.gap*this.ratio,this.ctx.strokeRect(0,0,this.canvasWidth,this.canvasHeight);for(let i=0;i<this.rows;i++)for(let s=0;s<this.columns;s++)if(this.board[i]&&this.board[i][s]){const d=s*this.tileSize,h=i*this.tileSize,u={...e,0:[this.darkMode?e[0][1]:e[0][0],e[0][1]],default:[this.darkMode?e.default[1]:e.default[0],e.default[1]]};this.board[i][s].draw(this.ctx,d,h,this.tileSize,this.gap,u)}this.onScoreUpdate&&this.onScoreUpdate(this.score)}addRandomTile(){const e=[];for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++)this.board[t][i].value===0&&e.push({r:t,c:i});if(e.length===0&&this.checkGameOver()&&this.onGameOver){this.onGameOver();return}if(e.length>0){const{r:t,c:i}=e[Math.floor(Math.random()*e.length)];this.board[t][i].value=Math.random()<.9?2:4}}checkGameOver(){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)if(this.board[e][t].value===0)return!1;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++){const i=this.board[e][t].value;if(t<this.columns-1&&i===this.board[e][t+1].value||e<this.rows-1&&i===this.board[e+1][t].value)return!1}return!0}slide(e){const t=e.filter(s=>s.value!==0);for(let s=0;s<t.length-1;s++)t[s].value===t[s+1].value&&(t[s].value*=2,this.score+=t[s].value,t[s+1].value=0);const i=t.filter(s=>s.value!==0);for(;i.length<this.columns;)i.push(new G);return i}slideLeft(){for(let e=0;e<this.rows;e++)this.board[e]=this.slide(this.board[e]);this.addRandomTile(),this.drawBoard()}slideRight(){for(let e=0;e<this.rows;e++)this.board[e].reverse(),this.board[e]=this.slide(this.board[e]),this.board[e].reverse();this.addRandomTile(),this.drawBoard()}slideUp(){for(let e=0;e<this.columns;e++){const t=this.board.map(s=>s[e]),i=this.slide(t);for(let s=0;s<this.rows;s++)this.board[s][e]=i[s]}this.addRandomTile(),this.drawBoard()}slideDown(){for(let e=0;e<this.columns;e++){const t=this.board.map(s=>s[e]);t.reverse();const i=this.slide(t);i.reverse();for(let s=0;s<this.rows;s++)this.board[s][e]=i[s]}this.addRandomTile(),this.drawBoard()}saveGame(){const e={board:this.board.map(t=>t.map(i=>i.value)),score:this.score,rows:this.rows,columns:this.columns};localStorage.setItem("2048GameState",JSON.stringify(e))}loadGame(){const e=localStorage.getItem("2048GameState");if(e)try{const t=JSON.parse(e);return this.rows=t.rows,this.columns=t.columns,this.score=t.score,this.board=t.board.map(i=>i.map(s=>new G(s))),this.resizeBoard(),t}catch(t){return console.error("Error loading game state:",t),null}return null}}const q={class:"game-2048"},Q={class:"game-stats-header"},Z={class:"stat-item"},ee={class:"stat-value"},te={key:0,class:"stat-item game-controls-header"},se={class:"stat-value"},ae={class:"button-group"},oe={class:"game-controls-header"},ie={class:"game-container"},le={key:0,class:"game-over-modal"},ne={class:"modal-content"},re={key:0,class:"settings-overlay"},de={class:"settings-modal"},ce={class:"settings-content"},he={class:"setting-item"},ue={class:"range-value"},ve={class:"setting-item checkbox-item"},fe={class:"checkbox-label"},me={class:"button-group"},ge={__name:"2048",setup(z){const e=P(),t=c(null),i=c(0),s=c(!1),d=c(4),h=c(4),u=c(4),v=c(!1),f=c(!1),k=c(0),g=c(!1),T=c(0),x=c(0);let n=null;function B(){t.value&&(n=new K(t.value),n.setDarkMode(e.isDarkMode),n.setUseClassicColors(v.value),n.onScoreUpdate=l=>{i.value=l},n.onGameOver=()=>{s.value=!0},n.setBoardSize(d.value,h.value),n.initGame(),L(),console.log("Has saved game:",f.value))}function O(){const l=parseInt(u.value);l>=2&&l<=10&&(d.value=l,h.value=l,localStorage.setItem("2048-board-size",String(l)),p())}function p(){s.value=!1,i.value=0,n&&(n.setBoardSize(d.value,h.value),n.resetGame())}function A(){n&&(n.setUseClassicColors(v.value),n.drawBoard())}function D(){localStorage.setItem("2048-classic-colors",String(v.value)),A()}function m(){n&&n.saveGame()}function H(){if(n){const l=n.loadGame();l&&(d.value=l.rows,h.value=l.columns,u.value=l.rows,i.value=l.score,s.value=!1,f.value=!1)}}function L(){const l=localStorage.getItem("2048GameState");if(l){console.log("Found saved game state:",l);const o=JSON.parse(l);o.score>0&&(f.value=!0,k.value=o.score)}}function E(l){l.preventDefault(),l.stopPropagation();const o=l.touches[0]||l.changedTouches[0];T.value=o.clientX,x.value=o.clientY}function N(l){if(l.preventDefault(),l.stopPropagation(),!n||s.value)return;const o=l.changedTouches[0],r=o.clientX,W=o.clientY,C=r-T.value,y=W-x.value,_=30;Math.abs(C)<_&&Math.abs(y)<_||(Math.abs(C)>Math.abs(y)?C>0?n.slideRight():n.slideLeft():y>0?n.slideDown():n.slideUp(),m())}function R(l){if(!(!n||s.value))switch(l.code){case"ArrowLeft":l.preventDefault(),n.slideLeft(),m();break;case"ArrowRight":l.preventDefault(),n.slideRight(),m();break;case"ArrowUp":l.preventDefault(),n.slideUp(),m();break;case"ArrowDown":l.preventDefault(),n.slideDown(),m();break}}function U(){n&&n.resizeBoard()}return V(()=>e.isDarkMode,l=>{n&&(n.setDarkMode(l),n.drawBoard())}),$(async()=>{await X(),t.value?B():setTimeout(()=>{t.value&&B()},100);const l=localStorage.getItem("2048-classic-colors");l!==null&&(v.value=l==="true",D());const o=localStorage.getItem("2048-board-size");if(o){const r=parseInt(o);!Number.isNaN(r)&&r>=2&&r<=10&&(u.value=r,d.value=r,h.value=r,p())}document.addEventListener("keydown",R),window.addEventListener("resize",U)}),Y(()=>{document.removeEventListener("keydown",R),window.removeEventListener("resize",U)}),(l,o)=>(S(),w("div",q,[o[13]||(o[13]=a("div",{class:"game-header"},[a("h1",null,"2048")],-1)),a("div",Q,[a("div",Z,[o[7]||(o[7]=a("div",{class:"stat-label"},"Po√§ng",-1)),a("div",ee,b(i.value),1)]),f.value&&k.value>i.value?(S(),w("div",te,[o[8]||(o[8]=a("div",{class:"stat-label"},"Sparat spel",-1)),a("div",se,b(k.value)+" po√§ng",1),a("div",ae,[a("button",{class:"control-header-btn load-btn",onClick:H},"üíæ Ladda spel"),a("button",{class:"control-header-btn close-btn",onClick:o[0]||(o[0]=r=>f.value=!1)},"Avbryt")])])):M("",!0)]),a("div",oe,[a("button",{class:"control-header-btn settings-btn",onClick:o[1]||(o[1]=r=>g.value=!0)}," ‚öôÔ∏è Inst√§llningar "),a("button",{class:"control-header-btn restart-btn",onClick:p},"üîÑ Starta om")]),a("div",ie,[a("canvas",{ref_key:"gameCanvas",ref:t,class:"game-canvas",tabindex:"0",onTouchstart:E,onTouchend:N,onTouchmove:o[2]||(o[2]=F(()=>{},["prevent"]))},null,544),s.value?(S(),w("div",le,[a("div",ne,[o[9]||(o[9]=a("h2",null,"Spelet √§r slut!",-1)),a("p",null,"Din slutpo√§ng: "+b(i.value),1),a("button",{class:"action-button",onClick:p},"Starta Om")])])):M("",!0)]),o[14]||(o[14]=a("div",{class:"game-instructions"},[a("details",null,[a("summary",null,"Hur man spelar"),a("div",{class:"instructions-content"},[a("p",null," Anv√§nd piltangenterna f√∂r att flytta brickorna. N√§r tv√• brickor med samma nummer krockar, sl√•s de samman till en ny bricka med det dubbla v√§rdet. F√∂rs√∂k n√• 2048! "),a("ul",null,[a("li",null,"Styr med piltangenter eller svep p√• mobil."),a("li",null,"Du kan √§ndra br√§dstorlek och f√§rgtema i Inst√§llningar."),a("li",null,"Spelet sparas automatiskt efter varje drag.")])])])],-1)),g.value?(S(),w("div",re,[a("div",de,[a("button",{class:"close-settings-button",onClick:o[3]||(o[3]=r=>g.value=!1),"aria-label":"St√§ng"}," ‚úï "),o[12]||(o[12]=a("h2",null,"Inst√§llningar",-1)),a("div",ce,[a("div",he,[o[10]||(o[10]=a("label",{for:"board-size-slider",class:"form-label"},"Br√§dstorlek",-1)),I(a("input",{id:"board-size-slider","onUpdate:modelValue":o[4]||(o[4]=r=>u.value=r),type:"range",min:"2",max:"10",class:"form-input range-input",onInput:O},null,544),[[J,u.value]]),a("div",ue,b(d.value)+" x "+b(h.value),1)]),a("div",ve,[a("label",fe,[I(a("input",{"onUpdate:modelValue":o[5]||(o[5]=r=>v.value=r),type:"checkbox",onChange:D},null,544),[[j,v.value]]),o[11]||(o[11]=a("span",null,"Anv√§nd klassiska 2048-f√§rger",-1))])])]),a("div",me,[a("button",{class:"action-button",onClick:o[6]||(o[6]=r=>g.value=!1)},"St√§ng")])])])):M("",!0)]))}};export{ge as default};
