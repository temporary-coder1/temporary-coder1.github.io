import{I as U,c as d,h as l,y as T,b as e,_ as H,A as ee,B as ie,r,F as I,C as j,e as g,D as ue,t as f,z as W,f as ce,d as A,v as de,s as ve,j as K,o as fe,a as me,w as pe,p as V,x as ke}from"./index-BP2jq8xO.js";const he=U({__name:"Cell",props:{isLit:{type:Boolean,required:!0},isClicked:{type:Boolean,required:!0}},emits:["pressed"],setup(v,{emit:i}){const n=i;return(u,m)=>(l(),d("div",{class:T(["cell",{highlighted:v.isClicked}]),onClick:m[0]||(m[0]=b=>n("pressed"))},[e("div",{class:T(["lamp",{lit:v.isLit}])},null,2)],2))}}),ge=H(he,[["__scopeId","data-v-80e11651"]]);function be(v,i,n){const u=_e(n);return v*3+i**2+u*7-13}function _e(v){const i="0123456789abcdefghijklmnopqrstuvwxyz";v=(v||"").toLowerCase().slice(0,3);let n=0;for(const u of v){const m=i.indexOf(u);if(m<0)return 0;n=n*36+m}return n}async function ye(v=300){const{data:i,error:n}=await ee.from("lightout_scores").select("playerID, score, clicks, seed, date").order("score",{ascending:!1}).order("clicks",{ascending:!0}).limit(v);return n?(console.error("Error fetching Lights Out scores:",n),[]):i}async function X(v){const i={...v,key:be(v.score,v.clicks,v.seed)},{data:n,error:u}=await ee.functions.invoke("lightsout/submit",{method:"POST",body:JSON.stringify(i)});if(u)throw console.error("Error submitting Lights Out score:",u),u;return n}const Se={class:"modal-content"},Ce={key:0},we={key:1},Le={key:2},$e={key:3},Oe={key:4},Me={key:5,class:"score-save-options"},De={key:0,class:"auth-user-options"},Ie={class:"save-prompt"},Ae={key:1,class:"unauth-user-options"},Te={class:"button-group-inline"},Be={key:1,class:"guest-form-overlay"},Fe={class:"button-group"},xe=["disabled"],Ne={key:0,class:"error-message"},Pe=U({__name:"SaveLightsOutScore",props:{score:{},clicks:{},seed:{},gameOver:{type:Boolean}},emits:["close","saved"],setup(v,{emit:i}){const n=ie(),u=v,m=i,b=r(""),S=r(!1),y=r(!1),C=r(!0),_=r(""),k=r(!1),h=r("");function $(){C.value=!1}async function O(){try{const c=n.profile?.username||n.user?.email||"User";await X({playerID:c,score:u.score,clicks:u.clicks,seed:u.seed}),m("saved"),m("close")}catch{h.value="Kunde inte spara poäng"}}function B(c){_.value=c,y.value=!0}function F(){y.value=!1,_.value=""}function D(){F()}function E(){S.value=!0}function x(){S.value=!1}async function N(){if(!k.value){if(!b.value.trim()){h.value="Visningsnamn är obligatoriskt";return}k.value=!0,h.value="";try{await X({playerID:b.value.trim(),score:u.score,clicks:u.clicks,seed:u.seed}),m("saved"),m("close")}catch{h.value="Nätverksfel - försök igen senare"}finally{k.value=!1}}}return(c,p)=>(l(),d(I,null,[y.value?(l(),j(ue,{key:0,mode:_.value,onClose:F,onSuccess:D,class:"auth-form"},null,8,["mode"])):g("",!0),e("div",Se,[c.gameOver?(l(),d("h2",Ce,"Bra kämpat!")):g("",!0),c.gameOver?(l(),d("h3",we,"Spara dina poäng?")):g("",!0),c.gameOver?(l(),d("p",Le,"Poäng: "+f(c.score),1)):g("",!0),c.gameOver?(l(),d("p",$e,"Klickar: "+f(c.clicks),1)):g("",!0),c.gameOver?(l(),d("p",Oe,"Seed: "+f(c.seed),1)):g("",!0),c.gameOver&&c.score>0&&C.value?(l(),d("div",Me,[W(n).isAuthed?(l(),d("div",De,[e("p",Ie,"Spara som "+f(W(n).profile?.username||"Användare")+"?",1),e("div",{class:"button-group-inline"},[e("button",{onClick:$,class:"btn-decline"},"Nej Tack"),e("button",{onClick:O,class:"btn-save"},"Spara Poäng")])])):(l(),d("div",Ae,[p[4]||(p[4]=e("p",{class:"save-prompt"},"Spara din poäng?",-1)),e("div",Te,[e("button",{onClick:p[0]||(p[0]=w=>B("login")),class:"btn-auth"},"Logga In"),e("button",{onClick:p[1]||(p[1]=w=>B("signup")),class:"btn-auth"},"Skapa Konto"),e("button",{onClick:E,class:"btn-guest"},"Som Gäst")]),e("button",{onClick:$,class:"btn-decline-full"},"Nej Tack")]))])):g("",!0),e("button",{onClick:p[2]||(p[2]=w=>c.$emit("close")),class:"btn-modal-action"},"Stäng")]),S.value?(l(),d("div",Be,[e("form",{onSubmit:ve(N,["prevent"]),class:"guest-form-modal"},[e("button",{type:"button",class:"close-form-button",onClick:x},"×"),p[5]||(p[5]=e("h2",null,"Spara som Gäst",-1)),p[6]||(p[6]=e("label",{for:"playerID-input",class:"form-label"},[e("abbr",{title:"","data-title":"Syns i topplistan för andra."},[A(" Visningsnamn"),e("span",{style:{color:"red"}},"*")])],-1)),ce(e("input",{type:"text",id:"playerID-input","onUpdate:modelValue":p[3]||(p[3]=w=>b.value=w),placeholder:"Ditt visningsnamn",class:"form-input",required:""},null,512),[[de,b.value]]),e("div",Fe,[e("button",{type:"button",class:"submit-button decline",onClick:x},"Avbryt"),e("button",{type:"submit",class:"submit-button primary",disabled:k.value},f(k.value?"Sparar...":"Spara!"),9,xe)]),h.value?(l(),d("div",Ne,f(h.value),1)):g("",!0)],32)])):g("",!0)],64))}}),ze=H(Pe,[["__scopeId","data-v-ab0b7abf"]]),Ee={class:"app-container"},Ge={class:"settings"},qe={class:"clicks"},Ke={class:"score"},Ve={class:"timeLeft"},je=["value"],Ue={class:"leaderboard-container"},He={class:"leaderboard-content"},Je={class:"leaderboard-table"},Re={class:"seed-row"},Qe={colspan:"6"},We={class:"seed-row__content"},Xe={class:"seed-tag"},Ye={class:"seed-meta"},Ze=["onClick"],et={class:"rank"},tt={class:"col-seed"},st={class:"col-date"},ot={class:"game-wrapper"},Y=180*1e3,Z="0123456789abcdefghijklmnopqrstuvwxyz",nt=U({__name:"LightsOut",setup(v){const i=r([]),n=r(5),u=r(5),m=r("000"),b=r(0),S=r(0),y=r(0),C=r(Y),_=r(null),k=r(!1),h=r(!1),$=r([]),O=r(!1),B=K(()=>{const s=Math.max(0,C.value),t=Math.floor(s/6e4),o=Math.floor(s%6e4/1e3);return`${t}:${o.toString().padStart(2,"0")}`});function F(){if(_.value!==null||k.value)return;const s=Date.now()+C.value;_.value=window.setInterval(()=>{const t=s-Date.now();C.value=t>0?t:0,t<=0&&(D(),k.value=!0)},250)}function D(){_.value!==null&&(window.clearInterval(_.value),_.value=null)}function E(s,t=3){s=Math.max(0,Math.floor(s))%Math.pow(36,t);let o="";do o=Z[s%36]+o,s=Math.floor(s/36);while(s>0);return o.padStart(t,"0")}function x(s){s=(s||"").toLowerCase().slice(0,3);let t=0;for(const o of s){const a=Z.indexOf(o);if(a<0)return 0;t=t*36+a}return t}function N(s){return(s||"").toLowerCase().replace(/[^0-9a-z]/g,"").slice(0,3)}function c(s){const t=s.target;m.value=N(t.value)}function p(s){m.value=N(s),P()}const w=K(()=>i.value.filter(s=>s.isLit).length);function te(s,t){if(s<0||s>=u.value||t<0||t>=n.value)return;const o=s*n.value+t;i.value[o].isLit=!i.value[o].isLit}function se(s){k.value||(_.value===null&&F(),S.value++,i.value.forEach(t=>t.isClicked=!1),i.value[s].isClicked=!0,J(s),oe())}function J(s){const t=Math.floor(s/n.value),o=s%n.value,a=[[0,0],[0,1],[0,-1],[1,0],[-1,0]];for(const[G,z]of a)te(t+G,o+z)}function oe(){console.log("Lit Cells",w.value),w.value<=0&&(y.value++,R())}async function R(){b.value=b.value+5,i.value=Array.from({length:u.value*n.value},()=>({isLit:!1,isClicked:!1}));const s=3+y.value*2;for(let t=0;t<s;t++){const o=Math.floor((b.value+t)*Math.sqrt((t+1)*3)%(n.value*u.value));J(o)}}function P(){b.value=x(m.value),D(),C.value=Y,k.value=!1,y.value=0,S.value=0,O.value=!1,R()}fe(()=>{const s=Math.floor(Math.random()*Math.pow(36,3));m.value=E(s,3),P(),Q()}),me(()=>{D()});const ne=K(()=>{const s=new Map;for(const o of $.value)s.has(o.seed)||s.set(o.seed,[]),s.get(o.seed).push(o);const t=[];for(const[o,a]of s.entries()){const z=[...a].sort((L,M)=>M.score!==L.score?M.score-L.score:L.clicks-M.clicks).slice(0,3),re=z.map((L,M)=>({...L,rank:M+1,key:`${L.playerID}-${L.date}-${M}`})),q=z[0];q&&t.push({seed:o,entries:re,best:{score:q.score,clicks:q.clicks}})}return t.sort((o,a)=>a.best.score!==o.best.score?a.best.score-o.best.score:o.best.clicks-a.best.clicks),t});async function Q(){$.value=await ye(),console.log("Fetched leaderboard:",$.value)}function ae(){h.value=!h.value}function le(s){try{return new Date(s).toLocaleDateString()}catch{return s}}return pe(k,s=>{s&&(O.value=!0)}),(s,t)=>(l(),d("div",Ee,[t[8]||(t[8]=e("h1",null,"Lights Out",-1)),e("div",Ge,[e("span",qe,"Klickar: "+f(S.value),1),e("span",Ke,"Poäng: "+f(y.value),1),e("span",Ve,"Tid kvar: "+f(B.value),1),t[1]||(t[1]=e("label",{for:"seedCode"},[e("strong",null,"Seed:")],-1)),e("input",{id:"seedCode",type:"text",value:m.value,onInput:c,placeholder:"a1b",maxlength:"3"},null,40,je),e("button",{onClick:P},"Använd"),k.value?(l(),d("button",{key:0,onClick:P,class:"restart-btn"},"Starta om")):g("",!0)]),e("div",Ue,[e("button",{onClick:ae,class:"leaderboard-toggle"},[t[2]||(t[2]=e("span",null,"🏆 Topplista",-1)),e("span",{class:T(["toggle-icon",{expanded:h.value}])},"▼",2)]),e("div",{class:T(["leaderboard-wrapper",{expanded:h.value}])},[e("div",He,[e("table",Je,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"#"),e("th",null,"Spelare"),e("th",null,"Poäng"),e("th",null,"Klickar"),e("th",null,"Seed"),e("th",null,"Datum")])],-1)),e("tbody",null,[(l(!0),d(I,null,V(ne.value,o=>(l(),d(I,{key:o.seed},[e("tr",Re,[e("td",Qe,[e("div",We,[e("span",Xe,[t[3]||(t[3]=A("Seed: ",-1)),e("strong",null,f(o.seed),1)]),e("span",Ye,[t[4]||(t[4]=A("Bäst: ",-1)),e("strong",null,f(o.best.score),1),t[5]||(t[5]=A("p • ",-1)),e("strong",null,f(o.best.clicks),1),t[6]||(t[6]=A(" klickar",-1))]),e("button",{class:"seed-row__btn",onClick:a=>p(o.seed)}," Använd seed ",8,Ze)])])]),(l(!0),d(I,null,V(o.entries,a=>(l(),d("tr",{key:a.key,class:T(["leaderboard-row",`rank-${a.rank}`])},[e("td",et,f(a.rank),1),e("td",null,f(a.playerID),1),e("td",null,f(a.score),1),e("td",null,f(a.clicks),1),e("td",tt,f(o.seed),1),e("td",st,f(le(a.date)),1)],2))),128))],64))),128))])])])],2)]),e("div",ot,[e("div",{class:"game-container",style:ke({gridTemplateColumns:`repeat(${n.value}, 1fr)`})},[(l(!0),d(I,null,V(i.value,(o,a)=>(l(),j(ge,{key:a,isLit:o.isLit,isClicked:o.isClicked,onPressed:G=>se(a)},null,8,["isLit","isClicked","onPressed"]))),128))],4)]),O.value?(l(),j(ze,{key:0,score:y.value,clicks:S.value,seed:m.value,gameOver:k.value,onClose:t[0]||(t[0]=o=>O.value=!1),onSaved:Q},null,8,["score","clicks","seed","gameOver"])):g("",!0)]))}}),lt=H(nt,[["__scopeId","data-v-49638631"]]);export{lt as default};
